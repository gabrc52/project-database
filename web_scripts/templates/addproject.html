<!DOCTYPE html>
<html lang="en">
<head>
    <title>Add Project</title>
    <meta charset="UTF-8">
    <style>
    td { padding: 5px; }
    .header td { border: 2px solid black; }
    .gone { border: 0; }
    </style>
    <!-- Based on https://stackoverflow.com/questions/14853779/adding-input-elements-dynamically-to-form -->
    <script type="text/javascript">
        // Global counter to obtain unique role field names:
        var role_counter = 0;

        function add_role() {
            var container = document.getElementById("roles_container");
            var role_fields = document.createElement("p");

            var role_name_label = document.createElement("label");
            role_name_label.setAttribute("for", "role_name");
            role_name_label.innerHTML = "Role name:"
            role_fields.appendChild(role_name_label);

            var role_name_field = document.createElement("input");
            role_name_field.setAttribute("type", "text");
            role_name_field.setAttribute("id", "role_name");
            role_name_field.setAttribute("name", "role_name_" + role_counter);
            role_fields.appendChild(role_name_field);

            role_fields.appendChild(document.createElement("br"));

            var role_description_label = document.createElement("label");
            role_description_label.setAttribute("for", "role_description");
            role_description_label.innerHTML = "Role description:"
            role_fields.appendChild(role_description_label);

            var role_description_field = document.createElement("input");
            role_description_field.setAttribute("type", "text");
            role_description_field.setAttribute("id", "role_description");
            role_description_field.setAttribute(
                "name", "role_description_" + role_counter
            );
            role_fields.appendChild(role_description_field);

            role_fields.appendChild(document.createElement("br"));

            var role_prereqs_label = document.createElement("label");
            role_prereqs_label.setAttribute("for", "role_prereqs");
            role_prereqs_label.innerHTML = "Role prereqs:"
            role_fields.appendChild(role_prereqs_label);

            var role_prereqs_field = document.createElement("input");
            role_prereqs_field.setAttribute("type", "text");
            role_prereqs_field.setAttribute("id", "role_prereqs");
            role_prereqs_field.setAttribute(
                "name", "role_prereqs_" + role_counter
            );
            role_fields.appendChild(role_prereqs_field);

            role_fields.appendChild(document.createElement("br"));

            var remove_roll_button = document.createElement("input");
            remove_roll_button.setAttribute("type", "button");
            remove_roll_button.setAttribute("value", "Remove role");
            remove_roll_button.setAttribute("onclick", "remove_role(this)");
            role_fields.appendChild(remove_roll_button);

            container.appendChild(role_fields);

            role_counter = role_counter + 1;
        }

        function remove_role(elem) {
            elem.parentElement.remove();
        }
    </script>
</head>
{% if user and can_add %}
    <body onload="add_role()">
{% else %}
    <body>
{% endif %}
    <h2>SIPB Project Database -- Add Project</h2>

    {% if not user %}
        <p><a href="{{ authlink }}">Sign in to create a project.</a></p>
    {% elif not can_add %}
        <p>You do not have access to create new projects. Please contact {{ help_address }} for help.</p>
    {% else %}
        <p>Signed in as {{ user }}.</p>

        <form action="performaddproject.py" method="POST">
            <p>
                <label for="name">Project name:</label>
                <input type="text" id="name" name="name">
            </p>
            <p>
                <label for="description">Description:</label><br>
                <textarea id="description" name="description" rows="24" cols="80"></textarea>
            </p>
            <p>
                <label>Status:</label>
                <input type="radio" id="active" name="status" value="active" checked="checked">
                <label for="active">Active</label>
                <input type="radio" id="inactive" name="status" value="inactive">
                <label for="inactive">Inactive</label>
            </p>
            <p>
                <label for="links">Link(s) (comma-separated):</label>
                <input type="text" id="links" name="links">
            </p>
            <p>
                <label for="comm_channels">Communication channel(s) (comma-separated):</label>
                <input type="text" id="comm_channels" name="comm_channels">
            </p>
            <p>
                <label for="contacts">Contact(s) (comma-separated, first is primary):</label>
                <input type="text" id="contacts" name="contacts">
            </p>
            <p>
                <label>Role(s):</label>
            </p>
            <div id="roles_container"></div>
            <p>
                <input type="button" value="Add another role" onclick="add_role()">
            </p>
            <p>
                <input type="submit" value="Create project">
            </p>
        </form>
    {% endif %}
</body>
</html>
